---
TOCTitle: 优化性能
Title: 优化性能
ms:assetid: '24dc9ca4-652b-41a6-9a99-95fdeca9120b'
ms:contentKeyID: 18112510
ms:mtpsurl: 'https://technet.microsoft.com/zh-cn/library/Cc720220(v=WS.10)'
---

优化性能
========

本部分中的主题将提供关于优化部署的 RMS 系统性能方面的信息。

优化目录服务性能
----------------

您可以监视 RMS 附带的目录服务性能计数器。如果需要，您可以通过修改控制 Active Directory 缓存属性的注册表设置来优化性能。

这些注册表设置可控制以下 Active Directory 缓存属性：

-   要缓存的最大主体数
-   缓存的主体信息的有效期
-   要缓存的最大组数
-   缓存的组信息的有效期
-   最大组成员身份项数
-   缓存的组成员身份信息的有效期

通常，缓存的信息的有效期越长或缓存中的项越多，RMS 响应获取目录服务信息请求的速度就越快。如果信息存储在 Active Directory 缓存中，则无需往返 Active Directory 来执行查找。这将缩短响应请求的时间。

但是，在 Active Directory 缓存中存储较多信息的缺点是需要更多系统内存资源。在配置注册表设置时要考虑的另一个问题是，为某项指定的有效期越长，从 Active Directory 缓存返回的某些结果就越有可能是无效的。比如，当 Active Directory 中的信息发生更改，但这些更改尚未反映到 Active Directory 缓存中时就会发生这种情况。如果会经常更改 Active Directory，最好为缓存的信息指定较短的有效期；有效期的长短应与更改的频率相对应。

目录服务性能计数器将在本主题中稍后的“[RMS：DirectoryServices 性能计数器](https://technet.microsoft.com/37afea1d-f320-4040-96d8-57c0b45e6d46)”中进行介绍。有关使用它们的操作说明，请参阅本主题中前面的“[使用性能计数器](https://technet.microsoft.com/096c3b17-c082-46c4-939c-4373af0c9dec)”。计数器监视的是“命中数”与“未命中数”。RMS 必须在每次未命中时执行 Active Directory 查找。

有关注册表设置的详细信息以及修改它们的操作说明，请参阅本主题中稍后的“[更改 Active Directory 缓存设置](https://technet.microsoft.com/8789a7a5-2065-4fae-9104-e0a70f1f2fb6)”。

优化 Active Directory 连接池设置
--------------------------------

要提高系统性能，您可以添加并修改控制 Active Directory 轻型目录访问协议 (LDAP) 连接池设置的注册表项。本主题中稍后的“[更改连接池注册表设置](https://technet.microsoft.com/c61d91db-a1ad-4ca5-a492-015da629afbc)”介绍了如何配置该注册表项。

RMS 专用于优化 LDAP 连接。它为每个 Active Directory 全局编录建立一个连接，且每个连接都可以为多个线程提供服务。为确保系统的健壮性，它还维持一个连接池以为各种请求提供服务。为避免单个全局编录的负载过重，RMS 使用某种算法来分发请求，这是通过在要查询的全局编录列表中的全局编录间执行负载均衡来实现的。此外，它还可根据需要自动处理 LDAP 错误并重新安排发送至不同全局编录的请求。

RMS 将创建一个全局编录列表，以便使用拓扑发现算法来进行查询。您可以指定在 RMS 服务启动前拓扑发现算法必须找到的可用全局编录的最小和最大数量。拓扑发现算法将首先找到位于当前站点的全局编录。然后，如果还需要其他全局编录，拓扑发现算法将在其他站点进行搜索。您还可以指定在 RMS 停止接受请求前变为不可用的最大连接数。如果查询列表上的一个或多个全局编录在此后变为不可用，拓扑发现算法将开始搜索替代全局编录并将其添加到查询列表。

或者，您可以列出您希望 RMS 使用的全局编录。这样，拓扑发现算法就不会搜索全局编录并添加到查询列表中。

您还可以配置设置，指定 RMS 在全局编录间执行负载均衡的方式。在决定是否向特定全局编录发送特定请求时，可以指定以下因素的相对重要性：

-   **循环法 (WtRoundRobin)**。此参数用于指定使用循环逻辑来平衡负载的相对重要性。默认的权值是 1，表示在选择全局编录时，这是服务器要考虑的事项中最不重要的。
-   **连接期间的线程计数 (WtThreadCount)**。此参数用于指定分配给连接的线程数的相对重要性。默认的权值是 100，表示对于所选连接来说，保持较低的全局编录线程数的重要性是使用循环逻辑平衡负载的重要性的 100 倍。
-   **慢速连接 (WtSlow)**。此参数用于指定慢速连接的相对重要性。默认的权值是 1,000，表示对于所选连接来说，保持到全局编录的快速连接的重要性是保持较低线程数的重要性的 10 倍。
