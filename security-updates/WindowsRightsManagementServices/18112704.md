---
TOCTitle: 监视消息队列
Title: 监视消息队列
ms:assetid: 'a7109399-3a84-4681-874b-f6ea1646b0a0'
ms:contentKeyID: 18112704
ms:mtpsurl: 'https://technet.microsoft.com/zh-cn/library/Cc747716(v=WS.10)'
---

监视消息队列
============

RMS 日志记录功能使用 Message Queuing (也称 MSMQ) 向日志数据库发送事件。每个 RMS 前端服务器都向 Message Queuing 服务提交消息，且每个前端服务器上的日志监听程序都可以从 Message Queuing 队列中检索日志记录消息，并将其写入日志数据库。如果无法使用日志数据库或数据库服务器，或者日志监听程序服务已停止，Message Queuing 将在队列中存储消息。如果计划关闭日志数据库或数据库服务器，建议您先关闭每个前端服务器上的日志监听程序服务，然后在重新启动数据库或数据库服务器后，在每个前端服务器上重新启动日志监听程序服务。

如果该数据库无法使用而日志监听程序服务仍在运行，则日志监听程序服务将无法向该数据库中写入日志记录消息。日志监听程序服务将把消息移到“死信”Message Queuing 队列中，直到该数据库可用，在此之后，新的日志记录消息将被写入该数据库中。死信队列中的消息不会被自动写入到日志数据库中。要查看和删除死信队列中的消息，请按下列步骤操作：

1.  打开 Microsoft 管理控制台 (MMC) 计算机管理单元。要完成这一操作，请单击“**开始**”，并依次选择“**所有程序**”、“**管理工具**”，然后单击“**计算机管理**”。
2.  在控制台树的“服务和应用程序”下，单击“Message Queuing”，然后单击“专用队列”。
3.  此时，可以看到两个队列。这两个队列的名称都以“**drms\_logging**”开头，后跟群集的名称。其中一个队列将命名为“**drms\_logging***\_&lt;your cluster name&gt;*\_**deadletter**”。这个队列是死信队列。请单击该队列名，然后单击“队列消息”队列。
4.  双击每条消息以查看其属性。
5.  要删除队列，请用右键单击“**队列消息**”队列，并选择“**所有任务**”，然后单击“**清除**”。

在默认配置中，Message Queuing 将存储所有队列消息，直到达到服务器上可用存储空间的限制。如果 MSMQ 使用了全部的可用硬盘空间，RMS 服务器将无法处理客户端请求。为防止出现上述情况，请按下列步骤限制 Message Queuing 可用来排队的磁盘空间的大小：

1.  打开 Microsoft 管理控制台 (MMC) 计算机管理单元。要完成这一操作，请单击“开始”，并依次选择“所有程序”、“管理工具”，然后单击“计算机管理”。
2.  在控制台树的“服务和应用程序”下，单击“Message Queuing”，然后单击“专用队列”。
3.  此时，可以看到两个队列。这两个队列的名称都将以“drms\_logging”开头。请对每个队列执行下列步骤：
    -   单击“属性”。
    -   选中“消息存储限额 (KB)”复选框，然后键入该队列中可以存储的所有队列消息的总大小（以 KB 计）。

如果队列已满，则 RMS 发送的消息将在到达后被放弃，与事件 ID 48 关联的下列事件消息将被发送到系统事件日志：

“未能将属性包发送到 Message Queuing。”

建议您对系统监视工具进行配置，以便在发生此事件时发出警报，因为它表示日志数据库出现问题。
